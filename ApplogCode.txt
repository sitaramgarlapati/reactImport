import { useEffect } from "react";
import { saveHistoryLog } from "../services/api";

const ApplicationDetails = ({ requestId }) => {
  useEffect(() => {
    const handleBeforeUnload = (event) => {
      // Retrieve saved logs from sessionStorage
      const savedLogs = JSON.parse(sessionStorage.getItem("savedLogs") || "{}");

      // Check if this requestId was already logged
      if (!savedLogs[requestId]) {
        saveHistoryLog({ eventType: "CLOSE", requestId }); // Log close event
        savedLogs[requestId] = true; // Mark as logged
        sessionStorage.setItem("savedLogs", JSON.stringify(savedLogs)); // Update sessionStorage
      }

      event.preventDefault();
      event.returnValue = "";
    };

    window.addEventListener("beforeunload", handleBeforeUnload);

    return () => {
      window.removeEventListener("beforeunload", handleBeforeUnload);
    };
  }, [requestId]); // Dependency on requestId

  return <div>Application Details Page</div>;
};

export default ApplicationDetails;
